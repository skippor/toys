<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta name="generator" content="SynEdit XHTML Exporter, http://synedit.sf.net/" />
  <title>outline.c</title>
  <style type="text/css">
    /*<![CDATA[*/
    code {FONT: 9pt; color : "#000000" background-color : "#FFFFFF";}
    
     .assembler {
      color : #000000;
     }
     .comment {
      color : #008000;
     }
     .float {
      color : #000000;
     }
     .hexadecimal {
      color : #000080;
     }
     .character {
      color : #000000;
     }
     .identifier {
      color : #FF0000;
     }
     .illegalchar {
      color : #000000;
     }
     .number {
      color : #000080;
     }
     .octal {
      color : #000000;
     }
     .preprocessor {
      color : #008080;
     }
     .reservedword {
      color : #0000FF;
     }
     .space {
      color : #008080;
     }
     .string {
      color : #800000;
     }
     .symbol {
      color : #000000;
     }
    /*]]>*/
  </style>
</head>
<body>
<pre>
<code><span class="comment">/*****************************************************************
 * outline.c
 *
 * Copyright 1999, Clark Cooper
 * All rights reserved.
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the license contained in the
 * COPYING file that comes with the expat distribution.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Read an XML document from standard input and print an element
 * outline on standard output.
 * Must be used with Expat compiled for UTF-8 output.
 */


</span><span class="preprocessor">#include &lt;stdio.h&gt;
#include &lt;expat.h&gt;

#ifdef XML_LARGE_SIZE
#if defined(XML_USE_MSC_EXTENSIONS) &amp;&amp; _MSC_VER &lt; 1400
#define XML_FMT_INT_MOD &quot;I64&quot;
#else
#define XML_FMT_INT_MOD &quot;ll&quot;
#endif
#else
#define XML_FMT_INT_MOD &quot;l&quot;
#endif

#define BUFFSIZE        8192

</span><span class="reservedword">char </span><span class="identifier">Buff</span><span class="symbol">[</span><span class="identifier">BUFFSIZE</span><span class="symbol">];

</span><span class="reservedword">int </span><span class="identifier">Depth</span><span class="symbol">;

</span><span class="reservedword">static void </span><span class="identifier">XMLCALL
start</span><span class="symbol">(</span><span class="reservedword">void </span><span class="symbol">*</span><span class="identifier">data</span><span class="symbol">, </span><span class="reservedword">const char </span><span class="symbol">*</span><span class="identifier">el</span><span class="symbol">, </span><span class="reservedword">const char </span><span class="symbol">**</span><span class="identifier">attr</span><span class="symbol">)
{
  </span><span class="reservedword">int </span><span class="identifier">i</span><span class="symbol">;

  </span><span class="reservedword">for </span><span class="symbol">(</span><span class="identifier">i </span><span class="symbol">= </span><span class="number">0</span><span class="symbol">; </span><span class="identifier">i </span><span class="symbol">&lt; </span><span class="identifier">Depth</span><span class="symbol">; </span><span class="identifier">i</span><span class="symbol">++)
    </span><span class="identifier">printf</span><span class="symbol">(</span><span class="string">&quot;  &quot;</span><span class="symbol">);

  </span><span class="identifier">printf</span><span class="symbol">(</span><span class="string">&quot;%s&quot;</span><span class="symbol">, </span><span class="identifier">el</span><span class="symbol">);

  </span><span class="reservedword">for </span><span class="symbol">(</span><span class="identifier">i </span><span class="symbol">= </span><span class="number">0</span><span class="symbol">; </span><span class="identifier">attr</span><span class="symbol">[</span><span class="identifier">i</span><span class="symbol">]; </span><span class="identifier">i </span><span class="symbol">+= </span><span class="number">2</span><span class="symbol">) {
    </span><span class="identifier">printf</span><span class="symbol">(</span><span class="string">&quot; %s='%s'&quot;</span><span class="symbol">, </span><span class="identifier">attr</span><span class="symbol">[</span><span class="identifier">i</span><span class="symbol">], </span><span class="identifier">attr</span><span class="symbol">[</span><span class="identifier">i </span><span class="symbol">+ </span><span class="number">1</span><span class="symbol">]);
  }

  </span><span class="identifier">printf</span><span class="symbol">(</span><span class="string">&quot;\n&quot;</span><span class="symbol">);
  </span><span class="identifier">Depth</span><span class="symbol">++;
}

</span><span class="reservedword">static void </span><span class="identifier">XMLCALL
end</span><span class="symbol">(</span><span class="reservedword">void </span><span class="symbol">*</span><span class="identifier">data</span><span class="symbol">, </span><span class="reservedword">const char </span><span class="symbol">*</span><span class="identifier">el</span><span class="symbol">)
{
  </span><span class="identifier">Depth</span><span class="symbol">--;
}

</span><span class="preprocessor">#ifdef AMIGA_SHARED_LIB
#include &lt;proto/expat.h&gt;
</span><span class="reservedword">int
</span><span class="identifier">amiga_main</span><span class="symbol">(</span><span class="reservedword">int </span><span class="identifier">argc</span><span class="symbol">, </span><span class="reservedword">char </span><span class="symbol">*</span><span class="identifier">argv</span><span class="symbol">[])
</span><span class="preprocessor">#else
</span><span class="reservedword">int
</span><span class="identifier">main</span><span class="symbol">(</span><span class="reservedword">int </span><span class="identifier">argc</span><span class="symbol">, </span><span class="reservedword">char </span><span class="symbol">*</span><span class="identifier">argv</span><span class="symbol">[])
</span><span class="preprocessor">#endif
</span><span class="symbol">{
  </span><span class="identifier">XML_Parser p </span><span class="symbol">= </span><span class="identifier">XML_ParserCreate</span><span class="symbol">(</span><span class="identifier">NULL</span><span class="symbol">);
  </span><span class="reservedword">if </span><span class="symbol">(! </span><span class="identifier">p</span><span class="symbol">) {
    </span><span class="identifier">fprintf</span><span class="symbol">(</span><span class="identifier">stderr</span><span class="symbol">, </span><span class="string">&quot;Couldn't allocate memory for parser\n&quot;</span><span class="symbol">);
    </span><span class="identifier">exit</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">);
  }

  </span><span class="identifier">XML_SetElementHandler</span><span class="symbol">(</span><span class="identifier">p</span><span class="symbol">, </span><span class="identifier">start</span><span class="symbol">, </span><span class="identifier">end</span><span class="symbol">);

  </span><span class="reservedword">for </span><span class="symbol">(;;) {
    </span><span class="reservedword">int </span><span class="identifier">done</span><span class="symbol">;
    </span><span class="reservedword">int </span><span class="identifier">len</span><span class="symbol">;

    </span><span class="identifier">len </span><span class="symbol">= </span><span class="identifier">fread</span><span class="symbol">(</span><span class="identifier">Buff</span><span class="symbol">, </span><span class="number">1</span><span class="symbol">, </span><span class="identifier">BUFFSIZE</span><span class="symbol">, </span><span class="identifier">stdin</span><span class="symbol">);
    </span><span class="reservedword">if </span><span class="symbol">(</span><span class="identifier">ferror</span><span class="symbol">(</span><span class="identifier">stdin</span><span class="symbol">)) {
      </span><span class="identifier">fprintf</span><span class="symbol">(</span><span class="identifier">stderr</span><span class="symbol">, </span><span class="string">&quot;Read error\n&quot;</span><span class="symbol">);
      </span><span class="identifier">exit</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">);
    }
    </span><span class="identifier">done </span><span class="symbol">= </span><span class="identifier">feof</span><span class="symbol">(</span><span class="identifier">stdin</span><span class="symbol">);

    </span><span class="reservedword">if </span><span class="symbol">(</span><span class="identifier">XML_Parse</span><span class="symbol">(</span><span class="identifier">p</span><span class="symbol">, </span><span class="identifier">Buff</span><span class="symbol">, </span><span class="identifier">len</span><span class="symbol">, </span><span class="identifier">done</span><span class="symbol">) == </span><span class="identifier">XML_STATUS_ERROR</span><span class="symbol">) {
      </span><span class="identifier">fprintf</span><span class="symbol">(</span><span class="identifier">stderr</span><span class="symbol">, </span><span class="string">&quot;Parse error at line %&quot; </span><span class="identifier">XML_FMT_INT_MOD </span><span class="string">&quot;u:\n%s\n&quot;</span><span class="symbol">,
              </span><span class="identifier">XML_GetCurrentLineNumber</span><span class="symbol">(</span><span class="identifier">p</span><span class="symbol">),
              </span><span class="identifier">XML_ErrorString</span><span class="symbol">(</span><span class="identifier">XML_GetErrorCode</span><span class="symbol">(</span><span class="identifier">p</span><span class="symbol">)));
      </span><span class="identifier">exit</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">);
    }

    </span><span class="reservedword">if </span><span class="symbol">(</span><span class="identifier">done</span><span class="symbol">)
      </span><span class="reservedword">break</span><span class="symbol">;
  }
  </span><span class="reservedword">return </span><span class="number">0</span><span class="symbol">;
}

</span></code></pre>
</body>
</html>